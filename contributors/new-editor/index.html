<!DOCTYPE html>
  
  
  
  
   <html class="no-js"> 

  <head lang="en-us">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=10" />
    <title>Integrating a new editor - Metals</title>
    <meta name="generator" content="Hugo 0.39" />

    
    <link rel="canonical" href="http://scalameta.org/metals/contributors/new-editor/">
    

    <meta property="og:url" content="http://scalameta.org/metals/contributors/new-editor/">
    <meta property="og:title" content="Metals">
    <meta property="og:image" content="http://scalameta.org/metals/logo.png">
    <meta name="apple-mobile-web-app-title" content="Metals">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <link rel="shortcut icon" type="image/x-icon" href="http://scalameta.org/metals/favicon.ico">
    <link rel="icon" type="image/x-icon" href="http://scalameta.org/metals/favicon.ico">

    <style>
      @font-face {
        font-family: 'Icon';
        src: url('http://scalameta.org/metals/fonts/icon.eot');
        src: url('http://scalameta.org/metals/fonts/icon.eot')
               format('embedded-opentype'),
             url('http://scalameta.org/metals/fonts/icon.woff')
               format('woff'),
             url('http://scalameta.org/metals/fonts/icon.ttf')
               format('truetype'),
             url('http://scalameta.org/metals/fonts/icon.svg')
               format('svg');
        font-weight: normal;
        font-style: normal;
      }
    </style>

    <link rel="stylesheet" href="http://scalameta.org/metals/stylesheets/application.css">
    <link rel="stylesheet" href="http://scalameta.org/metals/stylesheets/temporary.css">
    <link rel="stylesheet" href="http://scalameta.org/metals/stylesheets/palettes.css">
    <link rel="stylesheet" href="http://scalameta.org/metals/stylesheets/highlight/highlight.css">

    
    
    
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Roboto:400,700|Roboto&#43;Mono">
    <style>
      body, input {
        font-family: 'Roboto', Helvetica, Arial, sans-serif;
      }
      pre, code {
        font-family: 'Roboto Mono', 'Courier New', 'Courier', monospace;
      }
    </style>

    
    <link rel="stylesheet" href="http://scalameta.org/metals/style.css">
    
    <script src="http://scalameta.org/metals/javascripts/modernizr.js"></script>

    

  </head>
  <body class="palette-primary-blue-grey palette-accent-red">




<div class="backdrop">
	<div class="backdrop-paper"></div>
</div>

<input class="toggle" type="checkbox" id="toggle-drawer">
<input class="toggle" type="checkbox" id="toggle-search">
<label class="toggle-button overlay" for="toggle-drawer"></label>

<header class="header">
	<nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="title">
        Integrating a new editor
      </div>
    </div>

    

    
    
        
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" aria-label="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck>
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>
</header>

<main class="main">
	<div class="drawer">
		<nav aria-label="Navigation">
  <a href="http://scalameta.org/metals/" class="project">
    <div class="banner">
      
        <div class="logo">
          <img src="http://scalameta.org/metals/logo.png">
        </div>
      
      <div class="name">
        <strong>Metals <span class="version">0.1.0</span></strong>
        
      </div>
    </div>
  </a>

  <div class="scrollable">
    <div class="wrapper">
      

      <div class="toc">
        
        <ul>
          




<li>
  
    <span class="section">Contributors</span>
    <ul>
      
        
        



<a  title="Installation" href="/metals/contributors/installation/">
	
	Installation
</a>



      
        
        



<a class="current" title="Integrating a new editor" href="/metals/contributors/new-editor/">
	
	Integrating a new editor
</a>


<ul id="scrollspy">
</ul>


      
        
        



<a  title="Integrating a new build tool" href="/metals/contributors/new-build-tool/">
	
	Integrating a new build tool
</a>



      
    </ul>
  
</li>



<li>
  
    <span class="section">Users</span>
    <ul>
      
        
        



<a  title="Installation" href="/metals/users/installation/">
	
	Installation
</a>



      
    </ul>
  
</li>


        </ul>
        

        
      </div>
    </div>
  </div>
</nav>

	</div>

	<article class="article">
		<div class="wrapper">
			<h1>Integrating a new editor </h1>

			

<p>Before writing a new editor client, first check if someone else has managed to
integrate metals with your favorite text editor.</p>

<ul>
<li><a href="https://github.com/scalameta/metals/blob/master/vscode-extension/src/extension.ts">Visual Studio Code</a>,
maintained in this repo</li>
<li><a href="https://github.com/laughedelic/atom-ide-scala">Atom</a>, maintained by
<a href="https://github.com/laughedelic">@laughedelic</a></li>
<li><a href="https://github.com/rossabaker/lsp-scala">Emacs</a>, maintained by
<a href="https://github.com/rossabaker">@rossabaker</a></li>
<li>Others, see <a href="https://github.com/scalameta/metals/issues/217">#217</a>. Please
open an issue or ask on <a href="https://gitter.im/scalameta/metals">gitter</a> if you
want to create a new editor client.</li>
</ul>

<p>To integrate metals with a new editor, a few things should be kept in mind</p>

<!-- TOC depthFrom:2 depthTo:2 -->

<ul>
<li><a href="#launching-the-server">Launching the server</a></li>
<li><a href="#working-directory">Working directory</a></li>
<li><a href="#file-watching">File watching</a></li>
<li><a href="#configuration">Configuration</a></li>
<li><a href="#commands">Commands</a></li>
<li><a href="#code-actions">Code actions</a></li>
</ul>

<!-- /TOC -->

<h2 id="launching-the-server">Launching the server</h2>

<p>The server can be launched with
<a href="https://github.com/coursier/coursier/">coursier</a></p>

<p><a href="https://bintray.com/scalameta/maven/metals/_latestVersion"> <img src="https://api.bintray.com/packages/scalameta/maven/metals/images/download.svg" alt="Download" /> </a></p>

<pre><code>coursier launch -r bintray:scalameta/maven org.scalameta:metals_2.12:SERVER_VERSION -M scala.meta.metals.Main
</code></pre>

<p><code>SERVER_VERSION</code> can either be a locally published version of the metals server
via <code>sbt metals/publishLocal</code> or an unsupported pre-release published
automatically to Bintray by our Travis CI. There are no stable or officially
supported releases of metals.</p>

<p>The following Java options are recommended:</p>

<ul>
<li><code>-XX:+UseG1GC -XX:+UseStringDeduplication</code>: to reduce memory consumption from
navigation indexes. May not be necessary in the future.</li>
</ul>

<p>Refer to the coursier documentation for how to build a fat jar or configure java
parameters.</p>

<h2 id="working-directory">Working directory</h2>

<p>The server needs to be started in the same directory matching the <code>rootUri</code>
parameter of the <code>initialize</code> request. Goto definition and other
SemanticDB-features will not work if the working directory does not match the
root directory of the build.</p>

<p>NOTE. Discarding <code>rootUri</code> is not compliant with LSP, consider contributing to
<a href="https://github.com/scalameta/metals/issues/216">#216</a> if you are affected by this issue.</p>

<h2 id="file-watching">File watching</h2>

<p>Metals delegates file watching to the editor client by listening for
<a href="https://microsoft.github.io/language-server-protocol/specification#workspace_didChangeWatchedFiles"><code>workspace/didChangeWatchedFiles</code></a> notifications. The server expects the
client to send notifications for changes to files matching the following
patterns</p>

<ul>
<li><code>.metals/buildinfo/**/*.properties</code>: build metadata to enable goto definition
for the classpath, completions with the presentation compiler and refactoring
with Scalafix.</li>
<li><code>**/*.semanticdb</code>: artifacts produced by the semanticdb-scalac compiler plugin
during batch compilation in the build. See
<a href="https://github.com/scalameta/scalameta/blob/master/semanticdb/semanticdb3/semanticdb3.md">here</a>
to learn more about SemanticDB. These files are required for goto definition,
find references, hover and Scalafix to work.</li>
<li><code>project/target/active.json</code>: an indicator of the running sbt server.
Watching this file allows metals to (re)connect to the sbt server whenever it
is (re)started.</li>
</ul>

<p>See the VS Code plugin
<a href="https://github.com/scalameta/metals/blob/fb166f1d81eb77ebd9c6b3ee95e65fb58a907eec/vscode-extension/src/extension.ts#L44-L54">clientOptions</a>
for an example of how file watching is handled in VS Code.</p>

<p>The metals server scans the workspace directory for these file patterns on
startup regardless of file watching notifications. This means goto definition
and other functionality may work to begin with, but quickly degrade for longer
running sessions.</p>

<p>NOTE. The metals server does not use <code>DidChangeWatchedFilesRegistrationOptions</code>
to register these particular patterns, consider contributing to <a href="https://github.com/scalameta/metals/issues/255">#255</a> if you
are affected by this issue.</p>

<h2 id="configuration">Configuration</h2>

<p>Metals uses
<a href="https://microsoft.github.io/language-server-protocol/specification#workspace_didChangeWatchedFiles"><code>workspace/didChangeConfiguration</code></a>
notifications to allow end-users to control behavior of the server. The editor
client is expected to send a <code>workspace/didChangeConfiguration</code> notification
containing user configuration right after the <code>initialized</code> notification.</p>

<p>A full list of server configuration options can be found in
<a href="https://github.com/scalameta/metals/blob/master/metals/src/main/scala/scala/meta/metals/Configuration.scala">Configuration.scala</a>. All configuration options have default values. An
example of how the configuration options are used from the VS Code plugin can be
seen in the
<a href="https://github.com/scalameta/metals/blob/master/vscode-extension/package.json">package.json</a>
manifest.</p>

<p>Server side configuration options include settings to enable
experimental/unstable features such as completions with the presentation
compiler. Observe that even if metals registers the capability for completions
during the <code>initialize</code> handshake, the end-user must opt-into enabling
completions with the configuration setting <code>scalac.completions.enabled=true</code>. If
completions are disabled in the configuration
(<code>scalac.completions.enabled=false</code>, default value), then metals responds with
an empty list of completion suggestions.</p>

<p>Clients are also encouraged to implement this setting:</p>

<ul>
<li><code>serverVersion: String</code>: while metals is still under active development, it is
recommended to allow end-users to easily configure the version of the metals
server.</li>
</ul>

<p>Note: the <code>scalafmt.onSave: Boolean</code> setting may overlap with existing
functionality of your editor. For example, in VS Code it&rsquo;s possible to configure
<code>&quot;editor.formatOnSave&quot;: true</code> to trigger a <code>textDocument/formatting</code> request on
file save and for that reason the VS Code metals plugin does not support
<code>scalafmt.onSave</code>.</p>

<h2 id="commands">Commands</h2>

<p>Metals uses <a href="https://microsoft.github.io/language-server-protocol/specification#workspace_executeCommand"><code>workspace/executeCommand</code></a> requests to allow end-users to
trigger actions in the server on-demand. The full list of supported commands by
the server can be found in <a href="https://github.com/scalameta/metals/blob/master/metals/src/main/scala/scala/meta/metals/WorkspaceCommand.scala">WorkspaceCommand.scala</a>. See the VS Code plugin
<a href="https://github.com/scalameta/metals/blob/master/vscode-extension/package.json">package.json</a> manifest how these commands are configured in VS Code. Observe
that <code>restartServer</code> must be handled client-side.</p>

<h2 id="code-actions">Code actions</h2>

<p>Metals uses <a href="https://microsoft.github.io/language-server-protocol/specification#textDocument_codeAction"><code>textDocument/codeAction</code></a> requests from the editor client to
provide passive refactoring hints with scalafix. Currently, only the &ldquo;removed
unused import&rdquo; refactoring is supported but more refactorings may be added in
the future.</p>

<p><img src="/code-actions.png" align="right" width="150px" style="padding-left: 20px"/></p>

<p>The sequence diagram for refactoring hints is quite involved.</p>

<ol>
<li>Server publishes warning diagnostics about &ldquo;Unused import&rdquo;</li>
<li>Client sends a code action request with the &ldquo;Unused import&rdquo; warning as part
of <code>context.diagnostics</code>. Server responds with instructions to execute the
<code>scalafixUnusedImport</code> command.</li>
<li>User triggers the <code>scalafixUnusedImports</code> command on-demand.</li>
<li>Server sends request to apply a set of text edits. Client responds if edit
was successfully applied or not.</li>
<li>Server responds to <code>workspace/executeCommand</code> request.</li>
</ol>

<p>In VS Code, code actions are suggested to the user via light bulbs when hovering
above the &ldquo;Unused import&rdquo; warnings and can be triggered with the <code>CMD</code> + <code>.</code>
shortcut (on macOS).</p>

<p><img src="/code-actions.gif" alt="" /></p>


			<aside class="copyright" role="note">
				
				Documentation built with
				<a href="https://www.gohugo.io" target="_blank">Hugo</a>
				using the
				<a href="http://github.com/digitalcraftsman/hugo-material-docs" target="_blank">Material</a> theme.
			</aside>

			<footer class="footer">
				

<nav class="pagination" aria-label="Footer">
  <div class="previous">
  
      <a href="http://scalameta.org/metals/contributors/new-build-tool/" title="Integrating a new build tool">
        <span class="direction">
          Previous
        </span>
        <div class="page">
          <div class="button button-previous" role="button" aria-label="Previous">
            <i class="icon icon-back"></i>
          </div>
          <div class="stretch">
            <div class="title">
              Integrating a new build tool
            </div>
          </div>
        </div>
      </a>
  
  </div>

  <div class="next">
  
      <a href="http://scalameta.org/metals/overview/" title="Overview">
        <span class="direction">
          Next
        </span>
        <div class="page">
          <div class="stretch">
            <div class="title">
              Overview
            </div>
          </div>
          <div class="button button-next" role="button" aria-label="Next">
            <i class="icon icon-forward"></i>
          </div>
        </div>
      </a>
  
  </div>
</nav>





			</footer>
		</div>
	</article>

	<div class="results" role="status" aria-live="polite">
		<div class="scrollable">
			<div class="wrapper">
				<div class="meta"></div>
				<div class="list"></div>
			</div>
		</div>
	</div>
</main>

    <script>
    
      var base_url = '';
      var repo_id  = '';
    
    </script>

    <script src="http://scalameta.org/metals/javascripts/application.js"></script>
    

    <script>
      /* Add headers to scrollspy */
      var headers   = document.getElementsByTagName("h2");
      var scrollspy = document.getElementById('scrollspy');

      if(scrollspy) {
        if(headers.length > 0) {
          for(var i = 0; i < headers.length; i++) {
            var li = document.createElement("li");
            li.setAttribute("class", "anchor");

            var a  = document.createElement("a");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", headers[i].innerHTML);
            a.innerHTML = headers[i].innerHTML;

            li.appendChild(a)
            scrollspy.appendChild(li);
          }
        } else {
          scrollspy.parentElement.removeChild(scrollspy)
        }


        /* Add permanent link next to the headers */
        var headers = document.querySelectorAll("h1, h2, h3, h4, h5, h6");

        for(var i = 0; i < headers.length; i++) {
            var a = document.createElement("a");
            a.setAttribute("class", "headerlink");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", "Permanent link")
            a.innerHTML = "Â¶";
            headers[i].appendChild(a);
        }
      }
    </script>

    

    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>

